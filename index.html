<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Himalaya Fly Game</title>
<style>
    body {
        margin: 0;
        font-family: 'Poppins', Arial, sans-serif;
        background: linear-gradient(to bottom, #87ceeb, #ffffff);
        text-align: center;
        overflow-x: hidden;
    }

    header {
        background: #2c3e50;
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        font-family: 'Trebuchet MS', sans-serif;
    }

    #gameArea {
        margin: 30px auto;
        max-width: 500px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    button {
        background: #27ae60;
        border: none;
        color: white;
        padding: 12px 20px;
        margin: 10px;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
        transition: 0.3s;
    }

    button:hover {
        background: #2ecc71;
    }

    #heightDisplay {
        font-size: 36px;
        margin: 20px;
        font-weight: bold;
        color: #2c3e50;
    }

    /* Leaderboard section */
    #leaderboard {
        margin-top: 30px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 12px;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    }

    #leaderboard h2 {
        margin: 0 0 10px;
        font-size: 22px;
        color: #2c3e50;
    }

    #leaderboardList {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    #leaderboardList li {
        background: rgba(44, 62, 80, 0.1);
        margin: 5px 0;
        padding: 8px;
        border-radius: 6px;
        font-size: 16px;
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.6);
        text-align: center;
    }

    .modal-content {
        background: #fff;
        margin: 25% auto;
        padding: 20px;
        border-radius: 10px;
        width: 80%;
        max-width: 400px;
    }

    .modal button {
        margin-top: 15px;
    }
</style>
</head>
<body>
<header>üèîÔ∏è Himalaya Fly Game</header>

<div id="gameArea">
    <p><strong>Throw will auto-stop in 3 seconds!</strong></p>
    <button onclick="startListening()">Start Throw</button>
    <div id="heightDisplay">Height: 0 m</div>
</div>

<!-- Leaderboard -->
<div id="leaderboard">
    <h2>üèÜ Leaderboard</h2>
    <ul id="leaderboardList"></ul>
</div>

<!-- Final Score Modal -->
<div id="finalModal" class="modal">
    <div class="modal-content">
        <p id="finalMessage"></p>
        <input type="text" id="playerName" placeholder="Enter your name">
        <br>
        <button onclick="submitScore()">Submit Score</button>
        <button onclick="closeModal()">Try Again</button>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
/* üî• Replace with your Firebase config */
const firebaseConfig = {
    apiKey: "AIzaSyBmjXmGD9jzBIWJxm2TPp9oaQRVN_v7TtU",
    authDomain: "himalayafly.firebaseapp.com",
    databaseURL: "https://himalayafly-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "himalayafly",
    storageBucket: "himalayafly.firebasestorage.app",
    messagingSenderId: "342193900033",
    appId: "1:342193900033:web:1d2d0a5cf158e4075c8e00",
    measurementId: "G-T58K1DT564"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* Game Vars */
let throwing = false, maxHeight = 0, lastY = null, velocity = 0;
let animationInterval;

function handleMotion(event) {
    if (!throwing) return;
    let y = event.accelerationIncludingGravity?.y || 0;
    if (lastY !== null) {
        velocity += (y - lastY) * 0.1;
        maxHeight += velocity * 0.05;
        if (maxHeight < 0) maxHeight = 0;
        document.getElementById("heightDisplay").innerText = "Height: " + Math.round(maxHeight) + " m";
    }
    lastY = y;
}

function startListening() {
    throwing = true;
    maxHeight = 0; lastY = null; velocity = 0;
    document.getElementById("heightDisplay").innerText = "Height: 0 m";
    window.addEventListener("devicemotion", handleMotion);

    setTimeout(stopThrow, 3000); // auto stop after 3 sec
}

function stopThrow() {
    if (!throwing) return;
    throwing = false;
    window.removeEventListener("devicemotion", handleMotion);
    let score = Math.max(0, Math.round(maxHeight * 2));

    // Animate counting up
    let current = 0;
    clearInterval(animationInterval);
    animationInterval = setInterval(() => {
        if (current >= score) {
            clearInterval(animationInterval);
            showFinalModal(score);
        } else {
            current++;
            document.getElementById("heightDisplay").innerText = `Height: ${current} m`;
        }
    }, 15);
}

function showFinalModal(score) {
    document.getElementById("finalMessage").innerText = "Your final score: " + score + " m";
    document.getElementById("finalModal").style.display = "block";
}

function closeModal() {
    document.getElementById("finalModal").style.display = "none";
}

function submitScore() {
    let name = document.getElementById("playerName").value || "Anonymous";
    let score = parseInt(document.getElementById("finalMessage").innerText.match(/\d+/)[0]);

    const newRef = db.ref("scores").push();
    newRef.set({ name, score, timestamp: Date.now() }).then(() => {
        fetchLeaderboard(); // reload leaderboard
    });
    closeModal();
}

/* Fetch leaderboard */
function fetchLeaderboard() {
    db.ref("scores").once("value", snapshot => {
        let scoresArray = [];
        snapshot.forEach(snap => scoresArray.push(snap.val()));
        scoresArray.sort((a, b) => b.score - a.score);
        scoresArray = scoresArray.slice(0, 10);

        let list = document.getElementById("leaderboardList");
        list.innerHTML = "";
        scoresArray.forEach(s => {
            let li = document.createElement("li");
            li.innerText = `${s.name}: ${s.score} m`;
            list.appendChild(li);
        });
    });
}
fetchLeaderboard();
</script>
</body>
</html>
